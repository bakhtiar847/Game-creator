<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Game Creator</title>
	<style>
		:root{
			--bg:#0f1724;
			--panel:#0b1220;
			--muted:#9aa8bf;
			--accent:#06b6d4;
			--accent-2:#22c55e;
			--glass: rgba(255,255,255,0.03);
			--rounded:12px;
			--height:64px;
		}
		html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#021025 120%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#e6eef8}
		/* Top bar */
		.topbar{
			height:var(--height);
			display:flex;
			align-items:center;
			justify-content:space-between;
			gap:16px;
			padding:8px 16px;
			background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
			border-bottom:1px solid rgba(255,255,255,0.03);
			backdrop-filter: blur(6px);
			position:sticky;top:0;z-index:50;
		}
		.topbar-left, .topbar-center, .topbar-right{display:flex;align-items:center;gap:12px}

		/* Project dropdown */
		.project-dropdown{position:relative}
		.proj-btn{
			display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted);
			font-weight:600;font-size:14px
		}
		.proj-btn .caret{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid var(--muted);opacity:0.9}
		.dropdown-panel{
			position:absolute;left:0;top:calc(100% + 10px);min-width:260px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.15));padding:12px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.04);display:none
		}
		.dropdown-panel.show{display:block}
		.proj-title{font-size:15px;font-weight:700;color:#f8fdff;margin-bottom:6px}
		.proj-meta{font-size:13px;color:var(--muted);line-height:1.3}

		/* Center tabs */
		.tabs{display:flex;gap:6px;align-items:center}
		.tab{
			padding:8px 14px;border-radius:999px;background:transparent;color:var(--muted);cursor:pointer;font-weight:600;font-size:14px;border:1px solid transparent;transition:all .15s ease
		}
		.tab:hover{background:rgba(255,255,255,0.02)}
		.tab.active{background:linear-gradient(90deg,var(--accent),#7c3aed);color:white;box-shadow:0 6px 18px rgba(7,89,133,0.18);transform:translateY(-1px)}

		/* Right run button */
		.run-btn{display:inline-flex;align-items:center;gap:10px;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#032024;font-weight:800;cursor:pointer;border:none;box-shadow:0 10px 30px rgba(6,182,212,0.18)}
		.run-btn .play{width:0;height:0;border-left:10px solid #032024;border-top:6px solid transparent;border-bottom:6px solid transparent}

		/* Small screens */
		@media (max-width:700px){
			.topbar-center{display:none}
			.proj-btn{padding:8px 10px}
		}

		/* Page content placeholder */
		main{padding:24px}
		.panel{background:rgba(255,255,255,0.02);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);min-height:240px}

		/* Files panel layout */
		.files-container{display:flex;gap:16px;height:calc(100vh - 200px)}
		.files-sidebar{flex:0 0 200px;background:rgba(255,255,255,0.01);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.02);overflow-y:auto}
		.files-main{flex:1;background:rgba(255,255,255,0.01);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.02);overflow-y:auto}
		.files-preview{flex:0 0 250px;background:rgba(255,255,255,0.01);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column}

		/* Folder tree */
		.folder-tree{list-style:none;padding:0;margin:0}
		.folder-item{padding:6px 0;cursor:pointer;color:var(--muted);font-size:13px;user-select:none;display:flex;align-items:center;gap:6px}
		.folder-item:hover{color:#e6eef8}
		.folder-toggle{width:16px;height:16px;display:flex;align-items:center;justify-content:center;margin-right:4px}
		.folder-icon::before{content:"üìÅ "}
		.file-icon::before{content:"üìÑ "}

		/* File list */
		.file-item{padding:8px;margin:4px 0;background:rgba(255,255,255,0.03);border-radius:6px;cursor:pointer;border:1px solid rgba(255,255,255,0.02);transition:all .15s ease}
		.file-item:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.08)}
		.file-item.selected{background:linear-gradient(90deg,var(--accent),#7c3aed);border-color:var(--accent)}
		.file-name{font-size:13px;font-weight:500}
		.file-type{font-size:11px;color:var(--muted)}

		/* Preview panel */
		.preview-header{font-weight:600;margin-bottom:12px;color:#f8fdff;font-size:13px}
		.preview-content{flex:1;overflow-y:auto;background:rgba(0,0,0,0.2);border-radius:6px;padding:12px;margin-bottom:12px;font-family:monospace;font-size:11px;line-height:1.5;white-space:pre-wrap;word-break:break-word}
		.open-btn{padding:10px 14px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#032024;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;width:100%}
		.open-btn:hover{opacity:0.9}
		.open-btn:disabled{opacity:0.5;cursor:not-allowed}
	</style>
</head>
<body>
	<header class="topbar">
		<div class="topbar-left">
			<div class="project-dropdown">
				<button class="proj-btn" id="projToggle" aria-haspopup="true" aria-expanded="false">
					<span class="proj-name">My Game Project</span>
					<span class="caret" aria-hidden="true"></span>
				</button>
				<div class="dropdown-panel" id="projPanel" role="menu" aria-label="Project details">
					<div class="proj-title">My Game Project</div>
					<div class="proj-meta">
						<div><strong>Owner:</strong> You</div>
						<div><strong>Created:</strong> 2025-11-18</div>
						<div style="margin-top:8px">A small project to build game scenes, assets, and code. Use the tabs to switch views.</div>
					</div>
				</div>
			</div>
		</div>

		<div class="topbar-center">
			<nav class="tabs" role="tablist" aria-label="Editor tabs">
				<button class="tab active" data-tab="assets" role="tab" aria-selected="true">Assets</button>
				<button class="tab" data-tab="world" role="tab" aria-selected="false">World</button>
				<button class="tab" data-tab="code" role="tab" aria-selected="false">Code</button>
				<button class="tab" data-tab="files" role="tab" aria-selected="false">Files</button>
				<button class="tab" data-tab="settings" role="tab" aria-selected="false">Settings</button>
			</nav>
		</div>

		<div class="topbar-right">
			<button class="run-btn" id="runBtn" title="Run project">
				<span class="play" aria-hidden="true"></span>
				<span style="font-weight:700;color:#002126">Run</span>
			</button>
		</div>
	</header>

	<main>
		<section class="panel" id="panelAssets" data-panel>
			<h3>Assets</h3>
			<p class="muted">Place your assets here.</p>
		</section>
		<section class="panel" id="panelWorld" data-panel style="display:none;margin-top:16px">
			<h3>World</h3>
			<p class="muted">Configure the world and scenes.</p>
		</section>
		<section class="panel" id="panelCode" data-panel style="display:none;margin-top:16px">
			<h3>Code</h3>
			<p class="muted">Edit scripts for gameplay.</p>
		</section>
		<section class="panel" id="panelFiles" data-panel style="display:none;margin-top:16px;padding:0">
			<div class="files-container">
				<!-- Left sidebar: Folder tree -->
				<div class="files-sidebar">
					<div style="font-weight:600;margin-bottom:12px;color:#f8fdff;font-size:13px">Folders</div>
					<ul class="folder-tree" id="folderTree"></ul>
				</div>

				<!-- Middle: File list -->
				<div class="files-main">
					<div style="font-weight:600;margin-bottom:12px;color:#f8fdff;font-size:13px">Files</div>
					<div id="fileList"></div>
				</div>

				<!-- Right: Preview panel -->
				<div class="files-preview">
					<div class="preview-header">Preview</div>
					<div class="preview-content" id="previewContent">Select a file to preview</div>
					<button class="open-btn" id="openBtn" disabled>Open</button>
				</div>
			</div>
		</section>
		<section class="panel" id="panelSettings" data-panel style="display:none;margin-top:16px">
			<h3>Settings</h3>
			<p class="muted">Project and editor settings.</p>
		</section>
	</main>

	<script>
		const FileList = [
			{name : "Project", type : "folder", children : [
				{name : "Scripts", type : "folder", children : [
					{name : "main", type : "javascript", content : "console.log('Hello, world!');"}
				]},
				{name : "assets", type : "folder", children : []}
			]}
			];

		let selectedFile = null;

		// Files panel functionality
		(function(){
			const folderTree = document.getElementById('folderTree');
			const fileList = document.getElementById('fileList');
			const previewContent = document.getElementById('previewContent');
			const openBtn = document.getElementById('openBtn');

			// Render folder tree
			function renderFolderTree(){
				folderTree.innerHTML = '';
				FileList.forEach(item => {
					if(item.type === 'folder'){
						const li = document.createElement('li');
						li.className = 'folder-item';
						li.innerHTML = '<span class="folder-icon"></span><span>' + item.name + '</span>';
						li.addEventListener('click', () => {
							selectedFile = null;
							renderFileList(item.children || []);
							previewContent.textContent = 'Select a file to preview';
							openBtn.disabled = true;
						});
						folderTree.appendChild(li);
					}
				});
			}

			// Render file list
			function renderFileList(files){
				fileList.innerHTML = '';
				files.forEach(file => {
					if(file.type !== 'folder'){
						const div = document.createElement('div');
						div.className = 'file-item';
						div.innerHTML = '<div class="file-name"><span class="file-icon"></span>' + file.name + '</div><div class="file-type">' + file.type + '</div>';
						div.addEventListener('click', () => {
							document.querySelectorAll('.file-item').forEach(f => f.classList.remove('selected'));
							div.classList.add('selected');
							selectedFile = file;
							previewContent.textContent = file.content || '(No content)';
							openBtn.disabled = false;
						});
						fileList.appendChild(div);
					}
				});
			}

			// Initial render
			renderFolderTree();

			// Open button (placeholder)
			openBtn.addEventListener('click', () => {
				if(selectedFile){
					console.log('Opening file:', selectedFile);
				}
			});
		})();

		// Dropdown toggle
		(function(){
			const toggle = document.getElementById('projToggle');
			const panel = document.getElementById('projPanel');
			toggle.addEventListener('click', e=>{
				const show = !panel.classList.contains('show');
				panel.classList.toggle('show', show);
				toggle.setAttribute('aria-expanded', String(show));
			});
			document.addEventListener('click', e=>{
				if(!toggle.contains(e.target) && !panel.contains(e.target)){
					panel.classList.remove('show');
					toggle.setAttribute('aria-expanded','false');
				}
			});
		})();

		// Tabs behavior
		(function(){
			const tabs = Array.from(document.querySelectorAll('.tab'));
			const panels = Array.from(document.querySelectorAll('[data-panel]'));
			function activate(tab){
				tabs.forEach(t=>{t.classList.toggle('active', t===tab); t.setAttribute('aria-selected', String(t===tab));});
				const name = tab.dataset.tab;
				panels.forEach(p=>p.style.display = p.id === 'panel'+name.charAt(0).toUpperCase()+name.slice(1) ? '' : 'none');
			}
			tabs.forEach(t=>t.addEventListener('click', ()=>activate(t)));
		})();

		// Run button with loader, window management, and state tracking
		let gameWindow = null;
		const runBtn = document.getElementById('runBtn');

		function GenerateUserCode(){
			return "// == COMPILED/USER ==\n" + PrepareCode() + "\n// == COMPILED/USEREND ==";
		}

		function PrepareCode(){

		}

		// Prepare the player.html code
		async function prepareCode(){
			runBtn.innerHTML = '<span style="display:inline-block;width:16px;height:16px;border:2px solid rgba(3,32,36,0.3);border-top-color:#032024;border-radius:50%;animation:spin 0.8s linear infinite"></span>';
			try {
				const response = await fetch('./player.html');
				let html = await response.text();
				// Inject user code between compile markers
				const userCode = GenerateUserCode();
				html = html.replace(
					/\/\/\s*===\s*COMPILE\/USERCODESTART\s*===[\s\S]*?\/\/\s*===\s*COMPILE\/USERCODEEND\s*===/, userCode
				);
				return html;
			} catch(err) {
				console.error('Failed to load player.html:', err);
				runBtn.innerHTML = '<span class="play" aria-hidden="true"></span><span style="font-weight:700;color:#002126">Run</span>';
				alert("Failed to run the game. Please check your internet connection and try again.");
				return null;
			}
		}

		// Run the game in a new window
		async function run(){
			if(gameWindow && !gameWindow.closed){
				gameWindow.close();
				gameWindow = null;
				runBtn.innerHTML = '<span class="play" aria-hidden="true"></span><span style="font-weight:700;color:#002126">Run</span>';
				return;
			}

			const htmlContent = await prepareCode();
			if(!htmlContent) return;

			gameWindow = window.open('', 'gameWindow', 'width=1200,height=800');
			gameWindow.document.write(htmlContent);
			gameWindow.document.close();

			runBtn.innerHTML = '<span class="play" aria-hidden="true"></span><span style="font-weight:700;color:#002126">Running...</span>';

			// Monitor window closure
			const checkWindow = setInterval(()=>{
				if(gameWindow.closed){
					clearInterval(checkWindow);
					gameWindow = null;
					runBtn.innerHTML = '<span class="play" aria-hidden="true"></span><span style="font-weight:700;color:#002126">Run</span>';
				}
			}, 500);
		}

		// Add CSS animation for loader
		const style = document.createElement('style');
		style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
		document.head.appendChild(style);

		runBtn.addEventListener('click', run);
	</script>
</body>
</html>

